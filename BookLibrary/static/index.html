<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cohen's Library (Web)</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
  .container { max-width: 720px; margin: 0 auto; }
  h1 { margin: 0 0 16px; }
  .card { border: 1px solid #eee; border-radius: 8px; padding: 12px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
  .muted { color: #6b7280; }
  .row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 8px; }
  input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
  button { padding: 10px 14px; border: 0; border-radius: 8px; background: #2563eb; color: #fff; font-weight: 600; cursor: pointer; }
  button[disabled] { background: #93c5fd; cursor: not-allowed; }
  .link { background: transparent; color: #2563eb; cursor: pointer; }
  .danger { background: #dc2626; }
</style>
</head>
<body>
<div class="container">
  <h1>ðŸ“š Cohen's Library (Web)</h1>

  <div class="row" style="margin-bottom:12px;">
    <input id="title" placeholder="Enter Book Title" maxlength="100" />
    <input id="author" placeholder="Enter Author" maxlength="100" />
    <button id="saveBtn">Add Book</button>
  </div>

  <div id="info" class="muted"></div>
  <div id="list"></div>
</div>

<script>
  const $ = (s) => document.querySelector(s);
  const list = $("#list");
  const info = $("#info");
  const titleEl = $("#title");
  const authorEl = $("#author");
  const saveBtn = $("#saveBtn");

  let books = [];
  let editingIndex = null;

  function setStatus(msg, good=false) {
    info.textContent = msg || "";
    info.style.color = good ? "green" : "#6b7280";
  }

  function render() {
    list.innerHTML = "";
    if (!books.length) {
      const d = document.createElement("div");
      d.className = "muted";
      d.style.marginTop = "16px";
      d.textContent = "No books found. Add one above!";
      list.appendChild(d);
      return;
    }
    books.forEach((b, idx) => {
      const card = document.createElement("div");
      card.className = "card";
      const left = document.createElement("div");
      const t = document.createElement("div");
      t.textContent = b.title;
      t.style.fontWeight = "600";
      const a = document.createElement("div");
      a.textContent = "by " + b.author;
      a.className = "muted";
      left.appendChild(t); left.appendChild(a);

      const right = document.createElement("div");
      const edit = document.createElement("button");
      edit.className = "link";
      edit.textContent = "Edit";
      edit.onclick = () => {
        titleEl.value = b.title;
        authorEl.value = b.author;
        editingIndex = idx;
        saveBtn.textContent = "Update Book";
      };

      const del = document.createElement("button");
      del.className = "danger";
      del.textContent = "Delete";
      del.onclick = async () => {
        if (!confirm(`Delete "${b.title}"?`)) return;
        await fetch(`/books/${b.id}`, { method: "DELETE" });
        books.splice(idx, 1);
        render();
        setStatus("Deleted.", true);
      };

      right.appendChild(edit); right.appendChild(del);
      right.style.display = "flex"; right.style.gap = "8px";

      card.appendChild(left); card.appendChild(right);
      list.appendChild(card);
    });
  }

  async function load() {
    setStatus("Loading...");
    const r = await fetch("/books");
    books = await r.json();
    render();
    setStatus("");
  }

  saveBtn.onclick = async () => {
    const t = titleEl.value.trim();
    const a = authorEl.value.trim();
    if (!t || !a) { setStatus("Please enter both title and author."); return; }

    saveBtn.disabled = true;
    try {
      if (editingIndex !== null) {
        const b = books[editingIndex];
        const r = await fetch(`/books/${b.id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title: t, author: a }),
        });
        const data = await r.json();
        books[editingIndex] = data;
        editingIndex = null;
        saveBtn.textContent = "Add Book";
        setStatus("Updated!", true);
      } else {
        const r = await fetch("/books", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title: t, author: a }),
        });
        const data = await r.json();
        books.unshift(data);
        setStatus("Added!", true);
      }
      titleEl.value = ""; authorEl.value = "";
      render();
    } catch (e) {
      console.error(e);
      setStatus("Request failed. Check server logs.");
    } finally {
      saveBtn.disabled = false;
    }
  };

  load();
</script>
</body>
</html>
